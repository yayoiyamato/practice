<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>$.Deferredの練習</title>
</head>
<body>
<h1>$.Deferredの練習</h1>
   
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>

/*
 *  $.Deferred の練習
 */

'use strict';

// APIなげる処理（の想定）1
const getMonstersData =  () => {
   const dfd = $.Deferred()
   $.when($.getJSON('./monsters.json')).done((monsters) => {
      console.log('getMonstersData()内のdoneを実行')
      console.log(monsters)
      dfd.resolve()
   }).fail(() => {
      console.log('getMonstersData()内のfailを実行')
      dfd.reject()
   })
   return dfd.promise()
}

// APIなげる処理（の想定）2
const getAnimalsData =  () => {
   const dfd = $.Deferred()
   $.when($.getJSON('./animals.json')).done((animals) => {
      console.log('getAnimalsData()内のdoneを実行')
      console.log(animals)
      dfd.resolve()
   }).fail(() => {
      console.log('getAnimalsData()内のfailを実行')
      dfd.reject()
   })
   return dfd.promise
}

// APIを2つ非同期で投げて帰ってきた順にそれぞれ後続の処理したい
$.when.apply(null, getMonstersData()).done(() => {
   //取得できたらこれ実行したい
   console.log('getMonstersData()呼び出しのdoneを実行')
}).fail(() => {
   console.log('getMonstersData()呼び出しのfailを実行')
})

$.when.apply(null, getAnimalsData()).done(() => {
   //取得できたらこれ実行したい
   console.log('getAnimalsData()呼び出しのdoneを実行')
}).fail(() => {
   console.log('getAnimalsData()呼び出しのfailを実行')
})



</script>

</html>