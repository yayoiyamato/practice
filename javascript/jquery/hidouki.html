<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>非同期の練習</title>
</head>
<body>
<h1>非同期の練習</h1>
<div id="result"></div>
   
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>

/*
 * ポイント情報を取得
 */
 function getAllPointData(isMember = true) {
  if (isMember) {
    let pointA = []
    let pointB = []
    getMemberData().done(function(memberData) {
      if (memberData.length > 0) {
        memberData.some(function(e, i) {
          $.when(getEachPointData()).done(function(pointDataA, pointDataB) {
            // FIXME: jsonの結果とれん
            pointA.push(pointDataA)
            pointB.push(pointDataB)
            console.log(pointA)
            console.log(pointB)
          }).fail(function() {
            return true
          })
        })
      }
    }).fail(function() {
      console.log('ERROR：getMemberData')
    })
  } else {
    // 履歴情報を取得
      // 成功の場合
        // 結果が0件の場合、ありませんメッセージ
        // 結果が1件以上の場合、表示用の配列に入れる
      // 失敗の場合、エラーメッセージをセット
  }
}

/*
 * 会員情報を取得
 */
 function getMemberData() {
  const d = $.Deferred()
  $.get("./members.json").done(function(memberData) {
    d.resolve(memberData)
  }).fail(function() {
    d.reject()
  })
  return d.promise()
}

/*
 * 会員ごとのポイント情報を取得
 */
 function getEachPointData() {
  const da = $.Deferred()
  const db = $.Deferred()
  const task = []

  $.get("./pointsA.json").done(function(pointDataA) {
    da.resolve(pointDataA)
  }).fail(function() {
    console.log('ERROR：pointDataA')
    da.reject()
  })
  task.push(da.promise())

  $.get("./pointsB.json").done(function(pointDataB) {
    // console.log(pointDataB)
    db.resolve(pointDataB)
  }).fail(function() {
    console.log('ERROR：pointDataB')
    db.reject()
  })
  task.push(db.promise())

  return task
}

getAllPointData()
</script>

</html>