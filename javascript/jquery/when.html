<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>$.whenの練習</title>
</head>
<body>
<h1>$.whenの練習</h1>
<div id="result"></div>
   
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>

/*
 *  $.when の練習
 */

'use strict';
const target = document.getElementById('result').innerHTML = 'やっぴ'

// $.when(
//     $.getJSON('./monsters.json'),
//     $.getJSON('./animals.json')
// )
// .done(function(data_monsters, data_animals) {
//     // すべて成功した時の処理
//     console.log(data_monsters, data_animals);
// })
// .fail(function() {
//     // エラーがあった時
//     console.log('error');
// })

$.when(test(true)).done(function(result) {
    // すべて成功した時の処理
    console.log(result)
})
.fail(function() {
    // エラーがあった時
    console.log('error');
})

const target = document.getElementById('result')

const test = (isHidouki) => {
    if (isHidouki) {
        const dfd = $.Deferred
        $.when($.getJSON('./animals.json')).done((animals) => {
            target.innerHTML = 'getAnimalsData()内のdoneを実行'
            dfd.resolve()
        }).fail(() => {
            target.innerHTML = 'getAnimalsData()内のfailを実行'
            dfd.reject()
        })
        return dfd.promise
    } else {
        target.innerHTML = '非同期じゃない方を実行'
    }
}

</script>

</html>