<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>$.whenの練習</title>
</head>
<body>
<h1>$.whenの練習</h1>
<div id="result"></div>
   
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>

/*
 *  $.when の練習
 */

'use strict';

// $.when(
//     $.getJSON('./monsters.json'),
//     $.getJSON('./animals.json')
// )
// .done(function(data_monsters, data_animals) {
//     // すべて成功した時の処理
//     console.log(data_monsters, data_animals);
// })
// .fail(function() {
//     // エラーがあった時
//     console.log('error');
// })

const target = document.getElementById('result')
// 普通の処理と非同期の処理が混ざった関数
const test = function (isHidouki) {
    const dfd = $.Deferred()
    if (isHidouki) {
        $.when($.getJSON('./monsters.json')).done(function(data_monsters) {
            console.log(data_monsters)
            target.innerHTML = 'testのdone'
            dfd.resolve()
        }).fail(function() {
            target.innerHTML = 'testのfail'
            dfd.reject()
       })
    } else {
        target.innerHTML = '非同期じゃない方の処理'
        dfd.resolve()
    }
    return dfd.promise
}


$.when(test(true)).done(function() {
    target.innerHTML = '呼び出し元のdone'
})
.fail(function() {
    target.innerHTML = '呼び出し元のfail'
})

</script>

</html>